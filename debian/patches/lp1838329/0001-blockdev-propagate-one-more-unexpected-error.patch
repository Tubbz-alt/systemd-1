From: Lennart Poettering <lennart@poettering.net>
Date: Mon, 18 May 2020 18:29:57 +0200
Subject: [PATCH 1/7] blockdev: propagate one more unexpected error

From 6cba41ab0dbe5eb817f37bd43caff4754d801d3b Mon Sep 17 00:00:00 2001
Bug: https://github.com/systemd/systemd/issues/10179
Bug-Ubuntu: https://bugs.launchpad.net/ubuntu/+source/systemd/+bug/1838329
Origin: upstream, https://github.com/systemd/systemd/pull/15836
---
 src/basic/blockdev-util.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/src/basic/blockdev-util.c b/src/basic/blockdev-util.c
index 54431f5..19ffb47 100644
--- a/src/basic/blockdev-util.c
+++ b/src/basic/blockdev-util.c
@@ -78,6 +78,8 @@ int get_block_device(const char *path, dev_t *ret) {
                 *ret = st.st_dev;
                 return 1;
         }
+        if (errno != ENOENT)
+                return -errno;
 
         r = btrfs_get_block_device_fd(fd, ret);
         if (r > 0)
